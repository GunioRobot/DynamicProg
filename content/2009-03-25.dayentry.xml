<?xml version="1.0" encoding="utf-8"?>
<DayEntry xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="urn:newtelligence-com:dasblog:runtime:data">
  <Date>2009-03-24T17:00:00-07:00</Date>
  <Entries>
    <Entry>
      <Content>&lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;As I mentioned in a previous post I have been playing with the &lt;a href="http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=22739" target="_blank"&gt;Microsoft Lightweight Test Automation Framework&lt;/a&gt;.&lt;/p&gt;  &lt;p&gt;The Lightweight framework handle alert and confirms without any problem, both in IE and Firefox out of the box. I guess it won’t be an issue on the Mac either. Now window.open is another issue, a JavaScript error was thrown in both browsers.&lt;/p&gt;  &lt;p&gt;So here is how I fix it so far (so far because I still need to deal with a nasty bug on Firefox).&lt;/p&gt;  &lt;h3&gt;Window.open is not working (and a solution).&lt;/h3&gt;  &lt;p&gt;After digging around and thanks to Firebug (and at a lesser degree, the new Developer tools for IE8) I found that the problem seems to be in two places. Wait until the end of the post to change anything on your files.&lt;/p&gt;  &lt;p&gt;My first approach.&lt;/p&gt;  &lt;p&gt;First open the following file (in the source code solution for the framework).&lt;/p&gt;  &lt;p&gt;Engine/Resources/ScripFiles/BrowserFrame.js&lt;/p&gt;  &lt;p&gt;We will change the following line:&lt;/p&gt;  &lt;pre&gt;frame._originalOpen = frame.open; &lt;/pre&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;pre&gt;this._originalOpen = frame.open;&lt;/pre&gt;

&lt;p&gt;Engine/Resources/ScripFiles/TestExecutorBase.js&lt;/p&gt;

&lt;p&gt;Search for openWindowAndRegister: this is the function that will be assigned to window.open by the framework to handle the calls get a new window object and add it to the browser windows collection of the TestExecutor object.&lt;/p&gt;

&lt;p&gt;We will change the following line:&lt;/p&gt;

&lt;pre&gt;var newWindow = TestExecutor.get_activeWindow().get_activeFrame().get_jsFrame()._originalOpen(url, name, features, replace); &lt;/pre&gt;

&lt;p&gt;with the following code:&lt;/p&gt;

&lt;p&gt;var activeWindow = TestExecutor.get_activeWindow(); 
  &lt;br /&gt;var activeFrame = activeWindow.get_activeFrame(); 

  &lt;br /&gt;var newWindow = activeFrame._originalOpen(url, name, features, replace); 

  &lt;br /&gt;

  &lt;br /&gt;The temp variables are there just to help when debugging. Notice that we are calling _originalOpen on activeFrame and not activeFrame.get_jsFrame()&lt;/p&gt;

&lt;p&gt;Now this will make window.open functions work in IE but not in Firefox where I get an “Illegal operation on WrappedNative prototype object&amp;quot; exception, this seems to be a known regression on Firefox since at least version 1.07. &lt;/p&gt;

&lt;p&gt;Upon thinking about this I notice that we should be able to actual use window.open directly inside openWindowAndRegister.&lt;/p&gt;

&lt;p&gt;So here goes the solution that works, I kept the changes to BrowserFrame.js but the changes to TestExecutorBase are now as follow replace :&lt;/p&gt;

&lt;pre&gt;var newWindow = TestExecutor.get_activeWindow().get_activeFrame().get_jsFrame()._originalOpen(url, name, features, replace); &lt;/pre&gt;

&lt;p&gt;with the following code:&lt;/p&gt;

&lt;pre&gt;var newWindow = window.open(url, name, features, replace);&lt;/pre&gt;

&lt;p&gt;window.open returns a windows object and them we can register it to the _windowCollection internal array of the TestExecutor. So far I like this solution, now I need to figure out how to write test against this new window. I guess I will leave that for another post.&lt;/p&gt;</Content>
      <Created>2009-03-24T23:20:00-07:00</Created>
      <Modified>2009-03-22T19:40:45.8402377-07:00</Modified>
      <EntryId>063ee100-37ec-4a57-b751-d8f0569f049c</EntryId>
      <Description />
      <Title>Lightweight Test Framework, fixing how to handle window.open</Title>
      <Categories>Lightweight Testing Framework;Programming;Testing;Tools</Categories>
      <Author>hgarcia</Author>
      <IsPublic>true</IsPublic>
      <Syndicated>true</Syndicated>
      <ShowOnFrontPage>true</ShowOnFrontPage>
      <AllowComments>true</AllowComments>
      <Attachments />
      <Crossposts />
      <Latitude xsi:nil="true" />
      <Longitude xsi:nil="true" />
    </Entry>
  </Entries>
</DayEntry>